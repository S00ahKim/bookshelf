# 마이크로서비스

## 마이크로서비스란
> 작고, 자율적으로 협업하는 서비스
- 충분히 작다? 더 이상 작아질 수 없는 크기
    * 모놀리식 코드베이스에서 SRP를 준수하듯
    * 마이크로서비스 코드베이스는 **비즈니스 경계와 서비스 경계를 일치**시키며 **충분히 작아야** 한다
- 자율적? 다른 곳의 변경 없이 특정 서비스만 변경하고 배포 가능한가
    * 여러 가지 서비스를 동일 머신에 넣는 것이 좋음
    * 즉 서비스의 분산도가 높고 결합도coupling는 낮을수록 좋음


## 혜택
1. 기술 이기종성
    - 각 서비스가 자기에 맞는 각각 다른 기술을 사용할 수 있음
    - 신기술을 도입하는 것에 대한 허들이 좀 낮음
2. 회복성
    - 어떤 시스템의 장애가 전체 시스템의 장애로 이어지지 않음
    - 주의: 네트워크 장애를 다루는 방법을 이해할 필요 있음
3. 확장성
    - 모놀리식은 모든 것을 함께 확장해야 함
    - 마이크로서비스는 필요한 부분만 확장하면 됨
4. 배포 용이성
    - 모놀리식은 한 줄의 변경을 위해 모든 애플리케이션을 배포해야 함
    - 마이크로서비스는 독립적으로 배포/롤백 가능
5. 조직 부합성
    - 더 작은 팀이 더 작은 코드 베이슬 일할 때 더 생산적
    - 아키텍처 정렬, 팀원 인원 조정, 서비스 소유권 이전에 용이
6. 조합성
    - 기능을 재사용할 기회가 많음 (=다양한 창구로 서비스 제공 가능)
    - ex. 웹, 네이티브 앱, 모바일 앱, 태블릿 앱, 웨어러블 장치 등
7. 대체 가능성을 위한 최적화
    - 레거시를 더 나은 구현으로 교체하기 쉬움
    - 필요하지 않으면 제거하기도 쉬움 


## 서비스 지향 아키텍처 (SOA)
- 여러 서비스(=완전히 분리된 운영 시스템)가 네트워크 호출 통신으로 협업하는 설계
- 마이크로서비스는 SOA에 대한 특정 접근법으로 보아야 함
- 목표: 소프트웨어 재사용성
- 장점: 유지보수, 재작성 용이
- 어려움들
    * 통신 프로토콜 ex. SOAP
    * 벤더 미들웨어
    * 서비스 세분화에 대한 지침 부족
    * 분리할 시스템 선정에 대한 잘못된 지침


## 기타 분해 기술
- 분해(decomposition), 또는 팩토링(factoring): 이해하고 작성하고 유지하기 쉽도록 복잡한 문제/시스템을 외부 동작의 변경 없이 부분으로 나누는 것
- 프로세스 간 경계를 분리하는 것은 좋지만, 모든 문제를 해결하는 것은 아님
- 공유 라이브러리
    * 모든 언어가 지원하는 표준 분해 기술은 코드베이스를 여러 라이브러리로 나누는 것
    * 역할: 팀/서비스 간 기능 공유 & 재사용
    * 단점: 진정한 기술 이기종성 X / 독립적 확장의 어려움 / 독립된 배포의 어려움 / 결합 발생 지점
- 모듈
    * 어떤 언어는 라이브러리보다 뛰어난 모듈 분해 기술을 제공
    * 역할: 모듈의 수명주기 관리 (프로세스를 종료하지 않고 실행 중인 프로세스에 변경 모듈을 배포)
    * ex1: OSGI (단점: 언어의 충분한 지원 없이 수명주기 관리를 강제하려 함 & 과도한 결합 발생 가능성 높음)
    * ex2: 얼랭 (모듈이 언어 런타임으로 생성)


## 은총알은 없다
- 마이크로서비스는 모든 문제의 해답도 아니고, 이를 절대적으로 신봉하여 모든 것을 마이크로서비스화할 대상으로 볼 필요 없음
- 복잡성 유의: 분산 시스템, 분산 트랜잭션, CAP 정리
    * CAP 정리? consistency, availability, partition tolerance를 모두 만족하는 분산 컴퓨터 시스템은 존재하지 않음
        + 일관성(Consistency): 모든 노드가 같은 순간에 같은 데이터를 볼 수 있다.
        + 가용성(Availability): 모든 요청이 성공 또는 실패 결과를 반환할 수 있다.
        + 분할내성(Partition tolerance): 메시지 전달이 실패하거나 시스템 일부가 망가져도 시스템이 계속 동작할 수 있다.
        + P는 포기할 수 없는 조건이다. 진짜 리얼 월드에서 네트워크 장애는 회피할 수 없다. CAP는 네트워크 분단이 생겼을 때 일관성과 가용성 중 하나를 선택하라는 의미로 보는 게 좋다. (데이터 중심 애플리케이션 설계)
- 조직의 상황, 시스템의 상황 등 다양한 요인을 고려해야 한다