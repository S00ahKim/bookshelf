# 서비스 모델링하기

## 좋은 서비스의 기준
1. 느슨한 결합 (loose coupling)
    * 시스템의 추가 변경 없이 서비스 변경과 배포 가능
    * 강한 결합? 서비스를 엮은 통합 방식. 과도한 커뮤니케이션에 의해서도 발생 가능!
    * 느슨한 결합? 협업 서비스 알 필요 없음
2. 강한 응집력 (high cohesion)
    * 왜 응집? 변경할 때 한 쪽에서만 변경하고 빠르게 배포하기 원하므로
- => 즉, 연관된 행위는 한쪽에 모으고 다른 경계와는 느슨하게 소통할 수 있도록 경계는 problem domain 안에 있어야 함


## 경계가 있는 콘텍스트
> 명료한 경계에 의해 강제된 구체적인 책임
- 모든 도메인은 다수의 경계가 있는 콘텍스트로 구성됨
- 경계가 있는 콘텍스트는 다른 콘텍스트와 공유하는 모델과, 그렇지 않은 모델에 대한 명백한 인터페이스를 가짐

1. 감춰진 공유 모델
    * <창고>와 <재무부서> 를 경계가 있는 콘텍스트가, <재고 품목>은 둘이 공유하는 모델이 될 수 있다.
    * <재고 품목>은 공유되지만, 모든 것을 공유할 필요는 없다.
    * <재무부서>의 <총계정원장> 모델은 외부에 공개될 필요가 없다.
    * 두 콘텍스트에서는 같은 이름을 갖는 모델이 전혀 다른 의미로 사용될 수 있다.
2. 모듈과 서비스
    * 도메인 안에서 경계가 있는 콘텍스트를 발견하면, 모듈로 모델링하자.
    * 그렇게 모델링한 모듈의 경계는 마이크로서비스의 후보가 될 수 있다.
    * 바로 분리할 수도 있겠지만, 경계를 잘못 정하면 비용이 크기 때문에, 일단 안정화될 때까지 기다려 보자.
3. 성급한 분해
    * 시스템을 마이크로서비스로 성급하게 분리하면 막대한 비용이 소요될 수 있다 (특히 도메인 경험 부족 시)
    * 처음부터 마이크로서비스를 하기보다, 모놀리식에서 시작해서 마이크로서비스로 분해하는 것이 쉽다.


## 비즈니스 능력
- 경계가 있는 콘텍스트에 대한 고민을 할 때, `공유하는 모델`이 아니라, `나머지 도메인을 제공하는 콘텍스트의 능력` 관점에서 보라.
- 이 콘텍스트는 무슨 일을 하는가? 그 일을 하기 위해 어떤 데이터가 필요한가?
- 능력capability이 서비스로 모델링될 때 그것은 네트워크를 통해 다른 서비스에 노출될 주요 행위operation가 된다.


## 거북이 밑에 거북이 (nested case)
- 경계가 있는 콘텍스트는 그 안에 다수의 작은 경계가 있는 콘텍스트를 내포할 수 있다
    * ex. <창고>의 <주문 조달>, <제품 인수>, <재고 품목>
- 내포된 콘텍스트를 최상위 계층에 두는 것이 더 낫다고 판단할 수도 있다
    * ex. <창고>를 두지 않고 <주문 조달>, <제품 인수>, <재고 품목>을 최상위 계층에 두는 것
- 확실하지 않은 경우, 조직 구조에 기반하라. 
    * 각 내포된 콘텍스트를 관리하는 팀이 하나면 <창고>로 분리하는 것이 합리적
- 내포 방식은 단순하게 테스트하기 위해 아키텍처를 덩어리로 묶을 수 있다는 장점이 있다


## 비즈니스 콘셉트 관점에서의 커뮤니케이션
- 조직에서 공유하는 동일한 용어와 개념을 인터페이스에 반영할 것
- 마이크로서비스 간 전송되는 형태 = 조직 간에 전송되는 형태


## 기술적 경계
- 부정확한 모델링의 예시: 비즈니스에 초점을 맞춘 수직적 분리 대신, 동작하는 API를 수평 분리.
- 기술적 접합부에 따라 서비스 경계를 분리하는 것이 항상 잘못된 것은 아니다.
- 하지만, 기술 접합부를 찾는 두 번째 고려사항이 되는 것이 좋다.