# 옵셔널 반환은 신중히 하라

## 메서드가 특정 조건에서 값을 반환할 수 없을 때
- 자바 8 이전에 할 수 있었던 방법들에는 모두 허점이 있다
    1. 예외를 던진다
        * 예외는 '진짜 예외 상황'일 때에만 사용해야 한다 (item69)
        * 예외 스택 추적 전체를 캡처하는 비용이 크다
    2. null을 반환한다
        * 별도의 null 처리 코드가 필요하다
- 자바 8 이후 새로운 선택지가 생겼다
    1. Optional<T>를 반환한다
        * 검사 예외와 취지가 비슷하다. (item71) 사용자에게 값이 없을 수 있음을 알리는 목적이 크다.


## Optional<T> 사용법
### 반환하는 쪽에서는...
> 옵셔널을 반환해야 하는 상황에 그냥 null을 반환하지 말자
- 빈 옵셔널 `Optional.empty()`
- 값이 든 옵셔널 `Optional.of(value)`
    * value에 null을 넘기면 NPE 발생
- null 값을 허용하는 옵셔널 `Optional.ofNullable(value)`

### 호출하는 쪽에서는...
> 값을 못 받았을 때 어떻게 처리할지 선택하자
1. 기본값 설정
    * `.orElse("기본값")`
    * `.orElseThrow(NullAlarmException::new)`
2. 기본값 설정 비용이 부담된다면 필요할 때 가져오게 하자
    * `.orElseGet(fooRepository::getSomeNew)`
3. 항상 값이 있을 거라고 확신한다면 그냥 받아와도 되지만, 런타임 예외가 발생할 수 있다.
4. 적합한 기본값 처리를 하기 어렵다면, 그냥 값이 있는지 검사하고 쓰자.
    * `.isPresent()` (보통은 대체할 수 있으므로 신중하게 사용하자)


### 주의
- 컬렉션, 스트림, 배열 등 컨테이너 타입을 옵셔널로 감싸지 말자 (Optional<List<T>> 보다 그냥 빈 배열 리턴이 낫다)
- 성능이 중요한 상황에서는 옵셔널도 어쨌든 박싱하는 객체이므로 유의해서 사용하자
- 박싱된 기본 타입을 담은 옵셔널을 리턴하지 말자 (Optional<Integer> 대신 OptionalInt)
- 컬렉션의 키/값/원소 또는 배열의 원소로 옵셔널을 쓰는 것은 대부분 적절하지 않다