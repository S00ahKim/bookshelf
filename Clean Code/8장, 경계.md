# 경계
> 외부 코드와 우리 코드의 경계를 깔끔하게 처리하기


## 외부 코드 사용하기
- 인터페이스 제공자(최대한 범용적으로!) vs 사용자(최대한 지금의 필요에 집중!)
- 인터페이스를 사용하다보면 설계 의도와 맞지 않는 사용법이 등장할지도 모른다. 즉, 설계 의도에 맞게 사용할 책임이 사용자에 있다.
    ```java
    Map sensors = new HashMap();
    Sensor s = (Sensor)sensors.get(sensorId); // Map이 리턴하는 오브젝트를 Sensor로 바꾸는 책임이 사용자에 있다
    ``` 
- 어떤 해결책: Generics -> 가독성 개선, 불필요한 기능을 제거하는 문제 남음
    ```java
    Map<String, Sensor> sensors = new HashMap<Sensor>(); // sensors가 여기저기 넘어다닌다면, Map 인터페이스가 변하면 수정할 게 많아짐
    Sensor s = sensors.get(sensorId);
    ``` 
- 더 좋은 해결책: 경계 인터페이스를 우리 객체 안으로 숨긴다 (캡슐화)
    ```java
    public class Sensors {
      private Map sensors = new HashMap();

      public Sensor getById(String id) { // 이런 식으로 필요한 것만 정의하니까 `불필요한 기능을 제거하는 문제` 해결
        return (Sensor) sensors.get(id);
      }
    }

    Sensors sensors = new Sensors();
    Sensor s = sensors.getById(sensorId) // `가독성` 장점 유지
    ``` 
    * 프로그램에 필요한 인터페이스만 제공 -> 오용하기 어려움, 설계&비즈니스 규칙만 따르게 함
    * 모든 Map을 캡슐화하라는 의미가 아니다. sensors처럼 경계 인터페이스를 여기저기 넘기지(ex. 공개 API의 파라미터나 리턴값) 말라는 것! 
    * 클래스 바깥으로 노출하지 않도록 하자.


## 경계 살피고 익히기
- 외부 라이브러리를 가져왔을 때, 우리 버그/라이브러리 버그 여부를 찾는 것도 어려울 수 있다.
- 외부 코드는 익히기도, 통합하기도 어렵다.
- 대신, 테스트 케이스(a.k.a. `학습 테스트`)를 사용해서 외부 코드를 익히자.


## log4j 익히기
1. 문서를 자세히 읽기 전에 일단 첫 번째 테스트 케이스를 써본다.
2. 오류가 나는 부분을 문서와 구글링으로 해결한다.
3. 그러면서 얻는 각종 지식들을 잘 버무린다. 이해도가 높아진다.
4. log4j를 독자적인 logger로 캡슐화한다.


## 학습 테스트는 공짜 이상이다
- 어쨌든 API를 배우긴 해야 한다. 필요한 지식만 확보하는 쉬운 방법이다.
- 작성자의 이해도를 높인다.
- 새로운 버전이 나올 때 여전히 호환되는지 확인하기 좋다. (낡은 버전을 너무 오래 사용하지 않게 도와줌)


## 아직 존재하지 않는 코드를 사용하기
- 아직 모르는 코드(다른 팀에서 구현한느 코드, 인터페이스가 정의되지 않은 코드 등)의 경우, 자체적으로 인터페이스를 정의해서 사용한다.
- 후에, 모르던 코드가 알게 된 코드가 되면 어댑터를 구현해 간극을 메운다.
- 어댑터 패턴? 한 클래스의 인터페이스를 클라이언트에서 사용하고자 하는 다른 인터페이스로 변환하는 어댑터를 사용하는 패턴


## 깨끗한 경계
- 경계에서는 변경이 일어날 수 있다. 좋은 설계는 변경에 드는 비용이 적다.
- 경계의 코드는 깨끗하게 분리 -> 의존하는 코드는 우리가 아는 코드
- 기대하는 바를 테스트 코드로 설명