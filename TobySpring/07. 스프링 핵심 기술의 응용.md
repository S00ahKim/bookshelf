# 스프링 핵심 기술의 응용
> SQL과 DAO를 분리해보자!


## XML 설정 이용하기
- SQL을 스트링의 XML 설정파일로 빼내기
    * 문자열 값을 외부에서 DI하는 식으로 손쉽게 분리 가능
    * 새로운 SQL이 필요해질 때마다 프로퍼티 추가, 변수 추가, 수정자 추가 등 복잡함
- SQL을 맵 프로퍼티로 받아오기
    * 새로운 SQL이 필요하면 설정에 <entry>만 추가해주면 되어 간단함
    * 실제로 메소드가 실행되기 전까지는 에러 검출이 어려움


## SQL 제공 서비스 만들기
- 설정 정보와 SQL이 섞여 있으면 관리의 어려움이 있음
- 인터페이스를 만들면 DAO는 SQL의 출처에 신경쓰지 않아도 됨
- SQL을 저장하는 별도의 독립적인 파일을 만드는 것이 바람직함
    * 스프링 설정 파일의 <map>, <entry> 태그보다 <sqlmap>, <sql> 태그에 담는 것이 더 읽기 편함
- JAXB
    * 장점: XML 문서정보를 거의 동일한 구조의 오브젝트로 직접 매핑해주고, 자동으로 만들어주는 컴파일러 제공
    * 언마샬링: XML -> 자바 오브젝트
    * 마샬링: 바인딩 오브젝트 -> XML
    * cf. 직렬화(오브젝트 -> 바이트 스트림)와 유사함
- 특별한 이유가 없다면 XML 파일은 한 번만 읽게 할 것
    * 파일에서 SQL을 읽어와 내부에 저장해두는 초기 작업 필요
    * 생성자에서 하는 것 비추: 예외 발생 가능, 다루기 어렵고 보안 문제도 있음
    * 초기 상태의 오브젝트에 별도로 초기화 추천: 빈 후처리기 `@PostConstruct` 활용
        + 프로퍼티까지 준비된 뒤에 실행됨
    * 읽을 파일의 위치와 이름을 코드에 고정하지 말고 외부에서 DI 받게 할 것
- 인터페이스 분리
    * SQL 가져오기 & SQL 보관하고 사용하기 -> 분리할 만한 관심사
    * 만약 읽으려는 파일의 형식이 XML이 아니라면? -> 확장 가능한 구조로 변경 필요
    * 여러 종류의 책임에 대한 인터페이스를 받아 서비스 인터페이스를 만들고 이를 구현하기
    * 자기참조 빈: 책임들 간에 서로 호출하는 부분이 있더라도 그 다른 부분을 알고 있다는 전제로 코딩하면 안 됨. **자기 자신을 전달받더라도**, 다른 오브젝트라고 생각하고 인터페이스에 정의된 메소드를 통해서만 사용할 것.
    * 디폴트 의존관계: 디폴트라고 해도 좋을 만큼 기본적인 설정이 있다면, 외부에서 DI 받지 않는 이상 자동 적용되는 의존관계를 만들 수 있음. 생성자에서 디폴트 의존 오브젝트를 직접 만들어서 스스로 DI하면 됨. 유사하게 읽어올 파일 이름도 관례적으로 사용되는 이름을 디폴트로 넣어줄 수 있음.
        + 대신 사용하고 싶은 오브젝트가 있을 경우 설정에 프로퍼티 추가
        + 별다른 조정이 없다면 디폴트 프로퍼티와 추가 주입 프로퍼티가 모두 만들어짐. 빈 후처리기를 이용해 조정 가능.