# 성능 스키마
- 부하가 높은 DB를 튜닝하면서 변경의 영향도를 검증하기 위한 데이터를 저장하기 위한 데이터베이스
- mySQL 서버 내에서 실행되는 작업에 대한 상세한 메트릭 제공


## 구성요소
> 특정 인스트루먼트와 컨슈머가 활성화되어야 데이터를 수집하기 시작한다
1. 인스트루먼트: 정보를 얻으려는 코드의 부분. A에 대한 데이터를 수집하려면 A 인스트루먼트를 활성화해야 함.
    - 인스트루먼트를 활성화하면 추가 코드가 호출되어 CPU를 사용함
    - 슬래시 기호로 계층 구조를 구분하는 이름을 가짐 (대개 이름으로 역할 짐작 가능)
2. 컨슈머: 어떤 코드가 실행되었는지에 대한 정보를 저장하는 테이블.
    - 인스트루먼트가 정보를 보내는 대상
    - 성능 스키마는 인스트루먼트 결과를 많은 테이블에 저장함 (8버전대에는 약 110개의 테이블 존재)
    - 현재 및 과거 데이터, 요약 데이터, 다이제스트(쿼리템플릿), 인스턴스 등의 정보를 저장


## 자원 소비
- 성능 스키마에 의해 수집된 데이터는 메모리에 보관됨
- 최대 사이즈를 설정해서 사용하는 메모리양을 제한할 수 있음 & 최소할당 이후 점진적으로 조정 가능
- 그러나 인스트루먼트가 비활성화되었다고 할당된 메모리가 해제되지는 않음
- 초기 버전에서는 구현이 최적화되지 않아 리소스를 너무 많이 사용한다는 비판이 있었음


## 설정
- 성능 스키마 자체와 메모리 사용 및 수집된 데이터에 대한 제한과 관련된 변수를 활성화/비활성화하는 것은 서버 시작시에만 변경 가능
- 인스트루먼트와 컨슈머는 동적으로 활성화/비활성화 가능


## 사용
- 다양한 정보를 얻을 수 있음
    * 쿼리가 얼마나 많은 임시 테이블을 생성했는가
    * 쿼리가 인덱스를 타는 대신 전체 테이블 스캔을 얼마나 수행하는가
    * 이 테이블에는 어떤 종류의 쿼리가 많이 들어오는가
    * 자주 발생하는 오류는 무엇인가
    * 메모리 사용량은 얼마나 되는가
    * etc.
- sys 스키마
    * 5.7부터 mySQL 배포판에 포함된 성능 스키마 데이터에 대한 동반 스키마
        + 동반 스키마? 공통적으로 사용하는 메타테이블 같은 것
        + 성능 스키마에 대한 뷰와 스토어드 루틴([참고](http://www.ktword.co.kr/test/view/view.php?m_temp1=5428))으로만 구성되어 있음
        + 성능 스키마를 쉽게 사용할 수 있게 설계되어있으나, 자체적으로 데이터를 저장하는 것은 아님
    * 문제가 있는 구문을 찾는 데 사용할 수 있는 뷰를 제공
    * 메모리 통계를 더 편리하게 확인할 수 있는 뷰를 제공
- 조언
    * 성능 스키마를 활성화된 상태로 두고 쿼리 성능, 잠금, 디스크IO, 오류 등 문제 해결에 도움이 되는 인스트럭트&컨슈머를 동적으로 활성화하라.
    * 일반적인 질문을 해결하기 쉬운 sys 스키마를 활용하라.