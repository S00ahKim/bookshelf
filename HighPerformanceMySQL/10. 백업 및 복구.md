# 백업 및 복구
> 백업은 사전에 계획해야 하고, 정기적으로 실행해야 한다

## 핵심 용어
- 핫/웜/콜드 백업: 서버 다운타임이 필요하지 않는 경우가 hot이지만, 의미가 사용처마다 다름
- 복원(restore): 백업을 사용해서 필요한 위치에 데이터를 재배치
- 복구(recover): 문제가 발생한 후 시스템을 되살리는 프로세스. 복원을 포함함.
- 물리 백업(=원시 백업): 파일 복사본
- 논리 백업: 데이터 재구성 목적의 SQL

## 백업을 하는 이유
- 재해 복구: 하드웨어 장애/심각한 버그/악의적 공격 등
- 마음을 바꾸는 사람들
- 감사: 소송 대응 등
- 테스팅: 운영 서버 데이터를 테스트 서버에 옮김

## 복구 요구 사항 정의
- 백업 시스템 만들기 > 복구 시스템 만들기
    * 백업하지 않으면 애초에 복구할 수 없음
    * 백업은 자동화될 수 있음
    * 백업은 일상적, 복구는 특정 상황
    * 데이터 손상이 있으면 큰 피해가 발생할 수 있음
    * 적은 사람이 백업을 실행할 수 있음
- 복구 시점 목표(RPO), 복구 시간 목표(RTO) 고려 필요
- 구체적인 복구 목표와 백업 정책과 절차를 문서화할 것
- 주의: 백업=/=레플리카 (DB 자체가 다운될 수 있음)

## mySQL 백업 솔루션 설계
- 원시 백업 필수
- 다양한 시점의 백업 유지
- 논리적 백업을 주기적으로 추출하기
- 특정 시점 복구를 위한 바이너리 로그 보관
- 백업 프로세스 모니터링
- 복구 프로세스 테스트
- 보안
- 온라인/오프라인 백업: 서버를 오프라인으로 전환할 필요 없도록 백업을 설계하기. 백업 시간과 부하는 트레이드 오프.
- 논리적/원시 백업: (혼합) 원시 복사본 만들고 결과 데이터로 서버 인스턴스 시작 & mysqlcheck 실행 & 주기적으로 mysqldump로 논리적 백업 가져오기
- 백업 대상: 데이터, 테이블 정의, 불분명한 데이터들(로그), 코드(스토어드 프로시저 등), 서버 구성 파일, 운영 체제 파일 등
- 증분 백업/차등 백업: 둘 다 부분 백업. 전체 백업일 이후 변경된 모든 변경을 백업(차등), 전체 백업일 다음 백업 이후 변경된 모든 변경을 백업(증분)
- 복제: 원본에 영향을 미치거나 추가 부하를 가하지 않음 / but 레플리카의 데이터 불일치는 흔한 일

## 바이너리 로그 관리 및 백업
- mySQL은 복제에도 바이너리 로그를 사용함
- 바이너리 로그는 자주 백업하는 것이 좋음

## 백업과 복구 도구
- mySQL 엔터프라이즈 백업
- Percona XtraBackup
- mydumper
- mysqldump

## 데이터 백업하기
- 가장 적합한 지점을 찾기 위해 실험 필요
- 논리적 SQL 백업 (mysqldump)
- 파일시스템 스냅숏 (스냅숏 자체가 백업은 아님)

## 백업에서 복구하기
- 논리적 백업 복원
- 스냅숏에서 원시 파일 복원
- [선호; 물리] Percona XtraBackup으로 스트리밍 백업
- [선호; 논리] mysqldumper