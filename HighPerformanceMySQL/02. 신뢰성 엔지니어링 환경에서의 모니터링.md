# 신뢰성 엔지니어링 환경에서의 모니터링
- 만족스러운 고객 경험을 제공하기 위해 서비스의 성능과 질에 집중하는 사이트 신뢰성 엔지니어링
- DBA에게도 SRE는 중요한 가치
- 이를 위해서는 모니터링이 필요


## 서비스 수준의 목표
- 서비스 수준 지표 (SLI): 고객 만족도 측정법
    * 제품 기능이 증가함에 따라 SLI의 가짓수도 늘어남
    * mySQL의 경우 `가용성`, `지연시간`, `심각한 오류 제어`가 주요 테마
    * ex. 데이터베이스 요청의 99.5%가 오류 없이 2ms 이내에 처리될 것으로 예상한다.
- 서비스 수준 목표 (SLO): 이정도 이상은 만족해야 하는 정상 서비스 기준
    * 합의된 SLO를 달성하지 못하면 새로운 기능 작업을 추가해서는 안 됨
    * 운영 중 장애는 불가피하여 100%는 불가능하므로, 절대 최솟값이 무엇인지 파악 필요
- 서비스 수준 계약 (SLA): 고객이 SLO에 동의할 의향이 있는지에 대한 부분으로, 비즈니스적 측면이 강함


## 모니터링
> 상용 제품이나 오픈소스 등 다양한 도구로 모니터링할 수 있음
1. 가용성
    - 오류 없는 응답
    - 다양한 조건들에 대한 고려도 필요
        * 분산 시스템이라면?
        * 치명적 오류가 발생하면 애플리케이션에서는 무슨 처리를 해줘야 하는가?
        * 치명적/기능저하 등은 정확히 어떤 상황인가?
        * 얼마나 빨리 가용 상태로 복구할 수 있을까?
    - ex. `Threads_running` 호스트가 실행 중인 쿼리 수 추적. 계속 늘어날 경우 과부하 여부 점검 필요.
2. 쿼리 지연
3. 오류
    - 발생한 모든 오류를 추적하고 경고할 필요가 없을 수 있음
    - 사소한 오류가 지나치게 발생하면 큰 문제로 번질 수 있음
    - ex. `Connection_errors_xxx`
4. 선행 지표 파악
    - 실제로 문제가 발생하기 전에 곧 문제가 발생할 것 같다고 미리 알림받는 것
    - ex. `디스크 증가`, `연결 증가`, `복제 지연`, `I/O 활용`(비효율적인 쿼리 실행 점검, 디스크 액세스로 인한 병목 점검), `자동 증가 공간`(auto_increment 기본키가 최댓값에 도달한 경우), `백업 생성 및 복원 시간`(복구도 중요하지만 때로는 아예 솔루션이 필요한 경우가 있음. 특정 비즈니스 기능을 수행하는 테이블을 전용 클러스터로 분리하는 **기능적 샤딩**/양이 너무 많아진 경우 데이터 노드를 늘리는 **수평적 샤딩**)


## 장기적 성능 측정
- 비즈니스 케이던스 인식: 고객들은 언제 우리 서비스를 특히 더 이용하는가?
- 효과적인 메트릭 추적: 장기적인 계획을 위해 고려해야 할 지표는 다양하다.
- 성능 측정
    * 현재 문제는 없는가 & 장기적으로 추세가 어떻게 될 것 같은가
    * 평균을 맹신하지 말고 이상치를 주의할 것
    * 전체적인 추이를 볼 때에는 이상치를 제거할 것
    * 오래 쌓인 데이터를 볼 때에는 모니터링 도구의 성능이 중요함